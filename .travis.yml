sudo: required

language: minimal

services:
  docker

env:
  - DOCKER_COMPOSE_VERSION=17.12.0

before_script:
  - docker-compose version
  - docker-compose config --quiet

script:
  - docker-compose up --build --detach
  - sleep 30
  - docker-compose logs --no-color | grep "^relay" | grep "File Output" /dev/stdin
  - docker-compose logs --no-color | grep "^sink"  | grep "File Output" /dev/stdin
  - docker-compose logs --no-color | grep "^relay" | grep "Network Output" /dev/stdin
  - docker-compose logs --no-color | grep "^sink"  | grep "Network Output" /dev/stdin

after_failure:
  - docker-compose logs

after_script:
  - docker-compose down
